{"ast":null,"code":"import _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/liamz/Documents/open-source/everest/social/components/wrapper/KebabChain.js\";\n// import React, { Component } from 'react';\n// import {\n//   Switch,\n//   Route,\n//   withRouter\n// } from 'react-router-dom';\nimport Box from '3box';\nimport Cover from '../3box/Cover';\nimport React, { Component } from 'react';\nvar Box3Context = React.createContext({});\nexport var KebabChain =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(KebabChain, _Component);\n\n  function KebabChain(props) {\n    var _this;\n\n    _classCallCheck(this, KebabChain);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(KebabChain).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleLogin\",\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var history, addresses, myAddress, box, myProfile, chatSpace, myDid, loggedIn;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              history = _this.props.history;\n              _context.next = 3;\n              return window.ethereum.enable();\n\n            case 3:\n              addresses = _context.sent;\n              myAddress = addresses[0];\n\n              _this.setState({\n                disableLogin: true\n              }); // get my box and profile\n\n\n              _context.next = 8;\n              return Box.openBox(myAddress, window.ethereum, {});\n\n            case 8:\n              box = _context.sent;\n              _context.next = 11;\n              return Box.getProfile(myAddress);\n\n            case 11:\n              myProfile = _context.sent;\n              _context.next = 14;\n              return new _Promise(function (resolve, reject) {\n                return box.onSyncDone(resolve);\n              });\n\n            case 14:\n              _context.next = 16;\n              return box.openSpace('3chat');\n\n            case 16:\n              chatSpace = _context.sent;\n              myDid = chatSpace.DID; // set all to state and continue\n\n              loggedIn = true;\n\n              _this.setState({\n                chatSpace: chatSpace,\n                box: box,\n                myProfile: myProfile,\n                myAddress: myAddress,\n                myDid: myDid,\n                loggedIn: loggedIn\n              });\n\n            case 20:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _this.state = {\n      loggedIn: false,\n      box: {},\n      chatSpace: {},\n      myAddress: '',\n      myDid: '',\n      myProfile: {},\n      isAppReady: false,\n      topicList: [],\n      topicManager: {},\n      disableLogin: false\n    };\n    return _this;\n  }\n\n  _createClass(KebabChain, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var box = this.state.box; // if you haven't openedBox, return to login\n\n      this.setState({\n        isAppReady: true\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state = this.state,\n          isAppReady = _this$state.isAppReady,\n          chatSpace = _this$state.chatSpace,\n          topicManager = _this$state.topicManager,\n          topicList = _this$state.topicList,\n          myProfile = _this$state.myProfile,\n          myAddress = _this$state.myAddress,\n          myDid = _this$state.myDid,\n          disableLogin = _this$state.disableLogin,\n          loggedIn = _this$state.loggedIn;\n      var contextValue = {\n        myProfile: myProfile,\n        myAddress: myAddress,\n        myDid: myDid\n      };\n      return React.createElement(Box3Context.Provider, {\n        value: contextValue,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 87\n        },\n        __self: this\n      }, loggedIn || React.createElement(Cover, {\n        handleLogin: this.handleLogin,\n        disableLogin: disableLogin,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 89\n        },\n        __self: this\n      }), this.props.children);\n    }\n  }]);\n\n  return KebabChain;\n}(Component);\nexport function with3Box(Child) {\n  return function (props) {\n    return React.createElement(Box3Context.Consumer, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101\n      },\n      __self: this\n    }, function (props2) {\n      return React.createElement(Child, _extends({}, props, props2, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102\n        },\n        __self: this\n      }));\n    });\n  };\n}","map":{"version":3,"sources":["/Users/liamz/Documents/open-source/everest/social/components/wrapper/KebabChain.js"],"names":["Box","Cover","React","Component","Box3Context","createContext","KebabChain","props","history","window","ethereum","enable","addresses","myAddress","setState","disableLogin","openBox","box","getProfile","myProfile","resolve","reject","onSyncDone","openSpace","chatSpace","myDid","DID","loggedIn","state","isAppReady","topicList","topicManager","contextValue","handleLogin","children","with3Box","Child","props2"],"mappings":"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","sourcesContent":["\n// import React, { Component } from 'react';\n// import {\n//   Switch,\n//   Route,\n//   withRouter\n// } from 'react-router-dom';\nimport Box from '3box';\n\nimport Cover from '../3box/Cover';\n\n\nimport React, { Component } from 'react'\n\n\n\nconst Box3Context = React.createContext({})\n\n\n\n\nexport class KebabChain extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n        loggedIn: false,\n      box: {},\n      chatSpace: {},\n      myAddress: '',\n      myDid: '',\n      myProfile: {},\n      isAppReady: false,\n      topicList: [],\n      topicManager: {},\n      disableLogin: false,\n    };\n  }\n\n  componentDidMount() {\n    const { box } = this.state;\n\n    // if you haven't openedBox, return to login\n    this.setState({ isAppReady: true });\n  }\n\n  handleLogin = async () => {\n    const { history } = this.props;\n    const addresses = await window.ethereum.enable();\n    const myAddress = addresses[0];\n    this.setState({ disableLogin: true });\n\n    // get my box and profile\n    const box = await Box.openBox(myAddress, window.ethereum, {});\n    const myProfile = await Box.getProfile(myAddress);\n    await new Promise((resolve, reject) => box.onSyncDone(resolve));\n\n    // open 3chat space\n    const chatSpace = await box.openSpace('3chat');\n    const myDid = chatSpace.DID;\n\n    // set all to state and continue\n    const loggedIn = true\n    this.setState({ chatSpace, box, myProfile, myAddress, myDid, loggedIn });\n  }\n\n\n  render() {\n    const {\n      isAppReady,\n      chatSpace,\n      topicManager,\n      topicList,\n      myProfile,\n      myAddress,\n      myDid,\n      disableLogin,\n      loggedIn\n    } = this.state;\n\n    const contextValue = {\n        myProfile,\n      myAddress,\n      myDid,\n    }\n\n    return (\n        <Box3Context.Provider value={contextValue}>\n            {\n             loggedIn || <Cover handleLogin={this.handleLogin} disableLogin={disableLogin} />\n            }\n\n            {this.props.children}\n        </Box3Context.Provider>\n    );\n  }\n}\n\n\nexport function with3Box(Child) {\n    return (props) => (\n        <Box3Context.Consumer>\n            {(props2) => <Child {...props} {...props2} />}\n        </Box3Context.Consumer>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}