{"ast":null,"code":"import _Promise from \"@babel/runtime-corejs2/core-js/promise\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\n\nvar _marked =\n/*#__PURE__*/\n_regeneratorRuntime.mark(loadBox3),\n    _marked2 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(visitSpaces),\n    _marked3 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(loadSpace),\n    _marked4 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(_callee);\n\nimport { call, put, takeLatest, select } from 'redux-saga/effects';\nexport var LOAD_BOX3 = 'LOAD_BOX3';\nexport var WEB3_LOADING = 'WEB3_LOADING';\nexport var LOAD_BOX3_PENDING = 'LOAD_BOX3_PENDING';\nexport var LOAD_BOX3_COMPLETE = 'LOAD_BOX3_COMPLETE';\nexport var VISIT_SPACES = 'VISIT_SPACES';\nimport Box from '3box';\nimport Router from 'next/router';\nimport { persistor } from '../pages/_app';\n\nfunction syncBox(_x) {\n  return _syncBox.apply(this, arguments);\n}\n\nfunction _syncBox() {\n  _syncBox = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(box) {\n    return _regeneratorRuntime.wrap(function _callee2$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.next = 2;\n            return new _Promise(function (res, rej) {\n              box.onSyncDone(res);\n            });\n\n          case 2:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _syncBox.apply(this, arguments);\n}\n\nexport function loadBox3() {\n  var addresses, myAddress, box, myProfile;\n  return _regeneratorRuntime.wrap(function loadBox3$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return put({\n            type: WEB3_LOADING\n          });\n\n        case 2:\n          _context.next = 4;\n          return call(window.ethereum.enable);\n\n        case 4:\n          addresses = _context.sent;\n          myAddress = addresses[0];\n          _context.next = 8;\n          return put({\n            type: LOAD_BOX3_PENDING\n          });\n\n        case 8:\n          _context.next = 10;\n          return call(Box.openBox, myAddress, window.ethereum, {});\n\n        case 10:\n          box = _context.sent;\n          _context.next = 13;\n          return call(Box.getProfile, myAddress);\n\n        case 13:\n          myProfile = _context.sent;\n          _context.next = 16;\n          return call(syncBox, box);\n\n        case 16:\n          _context.next = 18;\n          return put({\n            type: LOAD_BOX3_COMPLETE,\n            payload: {\n              // box,\n              myProfile: myProfile,\n              myAddress: myAddress,\n              loggedIn: true // box, myProfile, myAddress\n\n            }\n          });\n\n        case 18:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked);\n}\nexport function visitSpaces() {\n  return _regeneratorRuntime.wrap(function visitSpaces$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          Router.push('/spaces');\n\n        case 1:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2);\n}\nexport function loadSpace() {\n  return _regeneratorRuntime.wrap(function loadSpace$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          Box.getSpace(address, name, opts);\n\n        case 1:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3);\n}\nexport default function _callee() {\n  return _regeneratorRuntime.wrap(function _callee$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return takeLatest(LOAD_BOX3, loadBox3);\n\n        case 2:\n          _context4.next = 4;\n          return takeLatest(VISIT_SPACES, visitSpaces);\n\n        case 4:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _marked4);\n}","map":{"version":3,"sources":["/Users/liamz/Documents/open-source/everest/social/sagas/index.js"],"names":["loadBox3","visitSpaces","loadSpace","call","put","takeLatest","select","LOAD_BOX3","WEB3_LOADING","LOAD_BOX3_PENDING","LOAD_BOX3_COMPLETE","VISIT_SPACES","Box","Router","persistor","syncBox","box","res","rej","onSyncDone","type","window","ethereum","enable","addresses","myAddress","openBox","getProfile","myProfile","payload","loggedIn","push","getSpace","address","name","opts"],"mappings":";;;;;;yBAqBiBA,Q;;;yBAuCAC,W;;;yBAIAC,S;;;;;AAhEjB,SAASC,IAAT,EAAeC,GAAf,EAAoBC,UAApB,EAAgCC,MAAhC,QAA8C,oBAA9C;AAEA,OAAO,IAAMC,SAAS,GAAG,WAAlB;AACP,OAAO,IAAMC,YAAY,GAAG,cAArB;AACP,OAAO,IAAMC,iBAAiB,GAAG,mBAA1B;AACP,OAAO,IAAMC,kBAAkB,GAAG,oBAA3B;AAEP,OAAO,IAAMC,YAAY,GAAG,cAArB;AAEP,OAAOC,GAAP,MAAgB,MAAhB;AAEA,OAAOC,MAAP,MAAmB,aAAnB;AACA,SAASC,SAAT,QAA0B,eAA1B;;SAGeC,O;;;;;;;2BAAf,kBAAuBC,GAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACU,aAAY,UAACC,GAAD,EAAMC,GAAN,EAAc;AAC5BF,cAAAA,GAAG,CAACG,UAAJ,CAAeF,GAAf;AACH,aAFK,CADV;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAMA,OAAO,SAAUjB,QAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACH,iBAAMI,GAAG,CAAC;AACNgB,YAAAA,IAAI,EAAEZ;AADA,WAAD,CAAT;;AADG;AAAA;AAIe,iBAAML,IAAI,CAACkB,MAAM,CAACC,QAAP,CAAgBC,MAAjB,CAAV;;AAJf;AAIGC,UAAAA,SAJH;AAKGC,UAAAA,SALH,GAKeD,SAAS,CAAC,CAAD,CALxB;AAAA;AAOH,iBAAMpB,GAAG,CAAC;AACNgB,YAAAA,IAAI,EAAEX;AADA,WAAD,CAAT;;AAPG;AAAA;AAWS,iBAAMN,IAAI,CAACS,GAAG,CAACc,OAAL,EAAcD,SAAd,EAAyBJ,MAAM,CAACC,QAAhC,EAA0C,EAA1C,CAAV;;AAXT;AAWGN,UAAAA,GAXH;AAAA;AAYe,iBAAMb,IAAI,CAACS,GAAG,CAACe,UAAL,EAAiBF,SAAjB,CAAV;;AAZf;AAYGG,UAAAA,SAZH;AAAA;AAcH,iBAAMzB,IAAI,CAACY,OAAD,EAAUC,GAAV,CAAV;;AAdG;AAAA;AAyBH,iBAAMZ,GAAG,CAAC;AACNgB,YAAAA,IAAI,EAAEV,kBADA;AAENmB,YAAAA,OAAO,EAAE;AACL;AACAD,cAAAA,SAAS,EAATA,SAFK;AAGLH,cAAAA,SAAS,EAATA,SAHK;AAILK,cAAAA,QAAQ,EAAE,IAJL,CAKL;;AALK;AAFH,WAAD,CAAT;;AAzBG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAuCP,OAAO,SAAU7B,WAAV;AAAA;AAAA;AAAA;AAAA;AACHY,UAAAA,MAAM,CAACkB,IAAP,CAAY,SAAZ;;AADG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIP,OAAO,SAAU7B,SAAV;AAAA;AAAA;AAAA;AAAA;AACHU,UAAAA,GAAG,CAACoB,QAAJ,CAAaC,OAAb,EAAsBC,IAAtB,EAA4BC,IAA5B;;AADG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKP,eAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AACX,iBAAM9B,UAAU,CAACE,SAAD,EAAYP,QAAZ,CAAhB;;AADW;AAAA;AAEX,iBAAMK,UAAU,CAACM,YAAD,EAAeV,WAAf,CAAhB;;AAFW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA","sourcesContent":["import { call, put, takeLatest, select } from 'redux-saga/effects'\n\nexport const LOAD_BOX3 = 'LOAD_BOX3'\nexport const WEB3_LOADING = 'WEB3_LOADING'\nexport const LOAD_BOX3_PENDING = 'LOAD_BOX3_PENDING'\nexport const LOAD_BOX3_COMPLETE = 'LOAD_BOX3_COMPLETE'\n\nexport const VISIT_SPACES = 'VISIT_SPACES'\n\nimport Box from '3box';\n\nimport Router from 'next/router'\nimport { persistor } from '../pages/_app';\n\n\nasync function syncBox(box) {\n    await new Promise((res, rej) => {\n        box.onSyncDone(res)\n    })\n}\n\nexport function* loadBox3() {\n    yield put({\n        type: WEB3_LOADING\n    })\n    const addresses = yield call(window.ethereum.enable)\n    const myAddress = addresses[0];\n    \n    yield put({\n        type: LOAD_BOX3_PENDING\n    })\n    // get my box and profile\n    const box = yield call(Box.openBox, myAddress, window.ethereum, {})\n    const myProfile = yield call(Box.getProfile, myAddress)\n\n    yield call(syncBox, box)\n\n    // open 3chat space\n    // const chatSpace = await box.openSpace('3chat');\n    // const myDid = chatSpace.DID;\n\n    // // set all to state and continue\n    // const loggedIn = true\n    // this.setState({ chatSpace, box, myProfile, myAddress, myDid, loggedIn });\n\n\n    yield put({\n        type: LOAD_BOX3_COMPLETE,\n        payload: {\n            // box,\n            myProfile,\n            myAddress,\n            loggedIn: true\n            // box, myProfile, myAddress\n        }\n    })\n\n    // yield call(persistor.flush)\n}\n\nexport function* visitSpaces() {\n    Router.push('/spaces')\n}\n\nexport function* loadSpace() {\n    Box.getSpace(address, name, opts)\n}\n\n\nexport default function* () {\n    yield takeLatest(LOAD_BOX3, loadBox3)\n    yield takeLatest(VISIT_SPACES, visitSpaces)\n}\n"]},"metadata":{},"sourceType":"module"}